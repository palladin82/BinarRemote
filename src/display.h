#include <U8g2lib.h>
#include <Wire.h>

#define OLED_SDA 4
#define OLED_SCL 15
#define OLED_RST 16
#define SCREEN_WIDTH 128 //display width, in pixels
#define SCREEN_HEIGHT 64 //display height, in pixels
U8G2_SSD1306_128X64_NONAME_F_HW_I2C *u8g2 = nullptr;
#define I2C_SDA                     4
#define I2C_SCL                     15
#define OLED_RST                    16

char CurMenu[256];

char *GetStatus(int Status);

#define bat_width  8
#define bat_height 11

static unsigned char image_bati[] = {
 0xff,0xe7,0x81,0xbd,0xbd,0xbd,0x81,0x81,0x81,0x81,0x81};

static unsigned char image_batt[] = {
 0x00,0x18,0x7e,0x42,0x42,0x42,0x7e,0x7e,0x7e,0x7e,0x7e};

static unsigned char image_temp[] = {
 0x08,0x3c,0x14,0x34,0x14,0x34,0x14,0x3e,0x2e,0x3e,0x1c};

static unsigned char image_tempi[] = {
 0xf7,0xc3,0xeb,0xcb,0xeb,0xcb,0xeb,0xc1,0xd1,0xc1,0xe3};

static unsigned char logo_bits[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0xF0, 0xFF, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0xFF, 
  0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 
  0x00, 0x00, 0x1F, 0x00, 0xF8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 
  0xC0, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x1F, 0x00, 0x00, 
  0x00, 0x00, 0x06, 0x00, 0x00, 0x1C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 
  0x00, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0x07, 0x38, 0x00, 0x00, 
  0x00, 0x00, 0xC0, 0xFF, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xE7, 
  0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x03, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0xF8, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x80, 0x3F, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 
  0xC0, 0x7F, 0x20, 0x08, 0x30, 0x1C, 0x08, 0x00, 0xC0, 0xFF, 0x70, 0x1C, 
  0x78, 0x1E, 0x1C, 0x00, 0xC0, 0xE3, 0x70, 0x3C, 0x78, 0x1E, 0xFC, 0x00, 
  0xE0, 0xE1, 0x70, 0x7C, 0x38, 0x3E, 0xFC, 0x01, 0xE0, 0xF8, 0x78, 0x7C, 
  0x38, 0x3E, 0xFC, 0x01, 0xE0, 0xFE, 0x38, 0x7C, 0x38, 0x3F, 0xDC, 0x01, 
  0xE0, 0x3F, 0x38, 0xFC, 0x3C, 0x3F, 0xDC, 0x01, 0xE0, 0x7E, 0x38, 0xFE, 
  0x1C, 0x3F, 0xDC, 0x01, 0xF0, 0xF0, 0x38, 0xEE, 0x9C, 0x3F, 0xFC, 0x01, 
  0xF0, 0xE0, 0x38, 0xEE, 0x9D, 0x3B, 0xFC, 0x01, 0x70, 0xE0, 0x38, 0xCE, 
  0x9D, 0x7B, 0xFC, 0x00, 0x70, 0xE0, 0x38, 0xCE, 0x9F, 0x73, 0xFC, 0x00, 
  0xF0, 0xE3, 0x3C, 0xCE, 0x8F, 0x7F, 0xFC, 0x01, 0xF0, 0xE7, 0x1C, 0x8E, 
  0x8F, 0x7F, 0xDC, 0x03, 0xF8, 0xFF, 0x1C, 0x8E, 0x8F, 0x7F, 0xDC, 0x07, 
  0xF8, 0xFF, 0x1C, 0x8F, 0xCF, 0xF3, 0x9C, 0x07, 0xF8, 0xFF, 0x1C, 0x0F, 
  0xCF, 0xE3, 0x1C, 0x0F, 0x00, 0x00, 0x18, 0x07, 0xCF, 0xE1, 0x1C, 0x1E, 
  0x00, 0x00, 0x00, 0x06, 0x8E, 0xE1, 0x1C, 0x1C, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0xC0, 0x1C, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x38, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x07, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x07, 0x00, 0x00, 0x00, 0x08, 0x00, 
  0x38, 0x00, 0x07, 0x00, 0x00, 0x00, 0x1C, 0x00, 0x38, 0x00, 0xE7, 0x03, 
  0xF0, 0x01, 0x1E, 0x00, 0x38, 0x00, 0xF7, 0x07, 0xF8, 0x03, 0x1E, 0x00, 
  0x38, 0x00, 0xFF, 0x0F, 0xF8, 0x07, 0x1E, 0x00, 0x38, 0x00, 0x77, 0x0E, 
  0x38, 0x0F, 0x1E, 0x00, 0x3C, 0x00, 0x07, 0x1E, 0x38, 0x0E, 0x1E, 0x00, 
  0x1C, 0x00, 0x07, 0x1C, 0x38, 0x0E, 0x1E, 0x00, 0x1C, 0x00, 0x07, 0x1C, 
  0x38, 0x0E, 0x3E, 0x00, 0x1C, 0x00, 0x07, 0x3C, 0x38, 0x0E, 0x3E, 0x00, 
  0x1C, 0x00, 0x07, 0x38, 0x38, 0x0E, 0x3E, 0x00, 0x1C, 0x00, 0x07, 0x78, 
  0x38, 0x0F, 0x3E, 0x00, 0x1C, 0x00, 0x07, 0x70, 0xF8, 0x0F, 0x7E, 0x00, 
  0x1C, 0x00, 0x07, 0x70, 0xF8, 0x07, 0x7E, 0x00, 0x1C, 0x00, 0x07, 0x70, 
  0xF8, 0x03, 0x7E, 0x00, 0x1C, 0x00, 0x07, 0x70, 0xF8, 0x00, 0x7E, 0x00, 
  0x1C, 0x00, 0x07, 0x70, 0xF8, 0x01, 0xFF, 0x00, 0x1C, 0x00, 0x07, 0x70, 
  0xFC, 0x01, 0xE7, 0x00, 0x1C, 0x00, 0x07, 0x70, 0xDC, 0x03, 0xE7, 0x00, 
  0x1C, 0x00, 0x07, 0x70, 0x9C, 0x03, 0xE7, 0x00, 0x1C, 0x00, 0x07, 0x70, 
  0x9C, 0x03, 0xE7, 0x00, 0x1C, 0x00, 0x07, 0x70, 0x9C, 0x03, 0xE7, 0x00, 
  0x1C, 0x00, 0x07, 0x70, 0x9C, 0x03, 0xE7, 0x01, 0x1E, 0x00, 0x07, 0x70, 
  0x9C, 0x07, 0xC7, 0x01, 0x0E, 0x00, 0x0F, 0x70, 0x1C, 0x07, 0xC7, 0x01, 
  0x0E, 0x00, 0x0E, 0x70, 0x1C, 0x07, 0xC7, 0x01, 0x0E, 0x00, 0x0E, 0x70, 
  0x1C, 0x07, 0xFF, 0x03, 0x0E, 0x00, 0x0E, 0x70, 0x1C, 0x0F, 0xFF, 0x03, 
  0x0E, 0x00, 0x0E, 0x78, 0x1C, 0x8E, 0xFF, 0x03, 0x0E, 0x00, 0x0E, 0x38, 
  0x1C, 0x8E, 0x8F, 0x03, 0x0E, 0x00, 0x1E, 0x3C, 0x1C, 0x8E, 0x83, 0x07, 
  0x0E, 0x00, 0x1C, 0x1E, 0x1C, 0x8E, 0x03, 0x07, 0x0E, 0x00, 0x1C, 0x0F, 
  0x1C, 0x9E, 0x03, 0x07, 0x0E, 0x00, 0xBC, 0x0F, 0x1C, 0x9C, 0x03, 0x06, 
  0x0E, 0x00, 0xF8, 0x07, 0x1C, 0x9C, 0x03, 0x00, 0xFE, 0x1F, 0xF8, 0x03, 
  0x18, 0xBC, 0x03, 0x00, 0xFE, 0x3F, 0xF0, 0x01, 0x00, 0xB8, 0x03, 0x00, 
  0xFC, 0x3F, 0x00, 0x00, 0x00, 0xB0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x80, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x03, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x80, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, };











String intToString(int num)
{
    String convert = String(num);
    //itoa(num,cstr,10);
    
    return convert;

}

void init_oled()
{
  //reset display via software

  Wire.begin(I2C_SDA, I2C_SCL);

  pinMode(OLED_RST, OUTPUT);
  digitalWrite(OLED_RST, HIGH); delay(20);
  digitalWrite(OLED_RST, LOW);  delay(20);
  digitalWrite(OLED_RST, HIGH); delay(20);


  Wire.beginTransmission(0x3C);
  if (Wire.endTransmission() == 0) {
    //Serial.println("Started OLED");
    u8g2 = new U8G2_SSD1306_128X64_NONAME_F_HW_I2C(U8G2_R1, U8X8_PIN_NONE);
    u8g2->begin();
    u8g2->enableUTF8Print();
    //enableUTF8Print();

    u8g2->clearBuffer();
    u8g2->setFlipMode(0);
    u8g2->setFontMode(1); // Transparent
    
    u8g2->firstPage();
    u8g2->setDrawColor(0);
    

    u8g2->setFontDirection(0);
    u8g2->firstPage();
    do {
      u8g2->setFont(u8g2_font_luBIS19_tr);
      //u8g2->drawStr(0, 30, "Binar-5s");
      u8g2->setCursor(0, 30);
      u8g2->print("Binar-5s");
      u8g2->setFont(u8g2_font_luBIS19_tr);
      //u8g2->drawStr(58, 60, "LoRa");
      u8g2->setCursor(58, 60);
      u8g2->print("LoRa");
    } while ( u8g2->nextPage() );
    u8g2->sendBuffer();
    //u8g2->setFont(u8g2_font_5x7_t_cyrillic); 
    
    u8g2->setFont(u8g2_font_haxrcorp4089_t_cyrillic);
    //u8g2->setFont(u8g2_font_unifont_t_cyrillic);
    //delay(1000);
    u8g2->clearBuffer();
    u8g2->setDisplayRotation(U8G2_R1);
    
    //delay(1000);
    u8g2->drawBox(0, 0, 64, 128);
    u8g2->setDrawColor(1);
    u8g2->drawXBM( 0, 0, 64, 128, logo_bits);
    u8g2->sendBuffer();
    //delay(1000);

    //u8g2->drawStr(10, 125, fbat);


  }  
  //delay(1000);
  u8g2->clearBuffer();
}



void displayMsg(char* msg)
{
  u8g2->setDrawColor(1);
  u8g2->drawBox(0, 60, 64, 13);
  u8g2->setDrawColor(0);
  //u8g2->drawStr(0, 70, msg);
  u8g2->setCursor(0, 70);
  u8g2->print(msg);
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}

void displayMsgS0(String msg)
{
  char chars[msg.length()+1];
  msg.toCharArray(chars,msg.length()+1);
  u8g2->setDrawColor(1);
  u8g2->drawBox(0, 50, 64, 13);
  u8g2->setDrawColor(0);
  //u8g2->drawStr(0, 80, chars);
  u8g2->setCursor(0, 60);
  u8g2->print(chars);
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}

void displayMsgS(String msg)
{
  char chars[msg.length()+1];
  msg.toCharArray(chars,msg.length()+1);
  u8g2->setDrawColor(1);
  u8g2->drawBox(0, 60, 64, 13);
  u8g2->setDrawColor(0);
  //u8g2->drawStr(0, 70, chars);
  u8g2->setCursor(0, 70);
  u8g2->print(chars);
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}

void displayMsgS1(String msg)
{
  char chars[msg.length()+1];
  msg.toCharArray(chars,msg.length()+1);
  u8g2->setDrawColor(1);
  u8g2->drawBox(0, 70, 64, 13);
  u8g2->setDrawColor(0);
  //u8g2->drawStr(0, 80, chars);
  u8g2->setCursor(0, 80);
  u8g2->print(chars);
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}

void displayMsgS2(String msg)
{
  char chars[msg.length()+1];
  msg.toCharArray(chars,msg.length()+1);
  u8g2->setDrawColor(1);
  u8g2->drawBox(0, 80, 64, 13);
  u8g2->setDrawColor(0);
  //u8g2->drawStr(0, 80, chars);
  u8g2->setCursor(0, 90);
  u8g2->print(chars);
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}


void displayBat(uint8_t msg)
{
  float battery=(float)msg/10;
  char fbat[6];
  sprintf(fbat, "%.1f", battery);
  
  
  u8g2->setDrawColor(0);
  u8g2->drawBox(0, 115, 32, 13);
  u8g2->setDrawColor(1);
  u8g2->drawXBM( 0, 115, bat_width, bat_height, image_batt);
  //u8g2->drawStr(10, 125, fbat);
  u8g2->setCursor(10, 125);
  u8g2->print(fbat);
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}

void displayTemp(char* msg)
{
  u8g2->setDrawColor(0);
  u8g2->drawBox(0, 103, 64, 13);
  u8g2->setDrawColor(1);
  u8g2->drawXBM( 0, 103, bat_width, bat_height, image_temp);
  //u8g2->drawStr(10, 113, msg);
  u8g2->setCursor(10, 113);
  u8g2->print(msg);
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}


void displayX()
{  
  u8g2->setDrawColor(0);
  u8g2->drawBox(0, 90, 15, 13);
  u8g2->setDrawColor(1);  
  //u8g2->drawStr(0, 100, "X");
  u8g2->setCursor(0, 100);
  u8g2->print("X");

  u8g2->sendBuffer();
  delay(30);
  u8g2->setDrawColor(0);
  u8g2->drawBox(0, 90, 15, 13);
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}

void displayRSSI()
{  
  u8g2->setDrawColor(0);
  
  u8g2->drawBox(0, 90, 15, 13);
  u8g2->setDrawColor(1);  
  //u8g2->drawStr(0, 100, "X");
  u8g2->setCursor(0, 100);
  u8g2->print("X");

  u8g2->sendBuffer();
  delay(30);
  u8g2->setDrawColor(0);
  u8g2->drawBox(0, 90, 15, 13);
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}

void displayStatus(char *msg)
{
  u8g2->setDrawColor(0);
  u8g2->drawBox(35, 115, 64, 13);
  u8g2->setDrawColor(1);
  //u8g2->drawStr(35, 125, GetStatus(atoi(msg)));
  u8g2->setCursor(35, 125);
  u8g2->print(GetStatus(atoi(msg)));
  u8g2->sendBuffer();
  u8g2->setDrawColor(1);
}


char *GetStatus(int Status)
    {
          static char msg[9];
          switch(Status)
          {
            case 0: sprintf(msg,"Off");return msg; break;
            case 1: sprintf(msg,"Start");return msg; break;
            case 3: sprintf(msg,"Warm");return msg; break;
            case 4: sprintf(msg,"Run");return msg; break;
            case 5: sprintf(msg,"Shut");return msg; break;            
            default: sprintf(msg,"E-%d",Status);return msg; break;
          }
          return msg;
    }

void displayValue(SimpleMenu *_menu)
{

  //u8g2->clearBuffer();
  u8g2->setDrawColor(1);
  u8g2->drawBox(0, 0, 64, 13);

  char buf[256];
  snprintf(buf, sizeof(buf), "%i", _menu->getUValue());
  u8g2->setDrawColor(0);
  
  //u8g2->drawStr(0, 10, buf);
  u8g2->setCursor(0, 10);
  u8g2->print(buf);

  u8g2->sendBuffer();
  u8g2->setDrawColor(1);

}




